# JDBC for Vert.x

A Vert.x library for interacting with a database that supports JDBC/SQL.

## Operations

The following operations are supported by this JDBC library and are all available after obtaining a `JdbcConnection` object.

To obtain a `JdbcConnection` from the service, do the following:

```java
service.getConnection(ar -> {
  if (ar.succeeded()) {
    JdbcConnection connection = ar.result();
  } else {
    ar.cause().printStackTrace();
  }
});
```

All the following examples below assume you have a `JdbcConnection`.

### Execute

Executes the given sql on the database, returning nothing.

```java
String sql = "CREATE TABLE people (ID int generated by default as identity (start with 1 increment by 1) not null, FNAME varchar(255), LNAME varchar(255), DOB date);";
connection.execute(sql, execute -> {
  if (execute.succeeded()) {
    System.out.println("Table created !");
  } else {
    execute.cause().printStackTrace();
  }
});
```

### Update

Updates the database `INSERT`, `UPDATE`, `DELETE`, passing the sql and parameters (optional). The result is an `UpdateResult` object
telling you how many rows were updated and the generated keys (if any) if it was an insert.

```java

connection.update("INSERT INTO people VALUES (null, 'john', 'doe', '2000-01-01');", null, insert -> {
  if (insert.succeeded()) {
    UpdateResult result = insert.result();
    System.out.println("Updated: " + result.getUpdated());
    System.out.println("Generated keys: " + result.getKeys());
  } else {
    insert.cause().printStackTrace();
  }
});


### Query

Queries the database (`SELECT`), passing the sql and parameters (optional). The result is a `ResultSet` object

```java
JsonArray params = new JsonArray().add("doe");
connection.query("SELECT * FROM people WHERE lname = ?", params, query -> {
  if (query.succeeded()) {
    System.out.println(query.result());
  } else {
    query.cause().printStackTrace();
  }
});
```

## Transactions

Transactions are supported using the `JdbcConnection` object and setting `autoCommit` to false.

For example

```java
connection.setAutoCommit(false, autoCommit -> {
  if (autoCommit.succeeded()) {
    // Do something in transaction
  } else {
    autoCommit.cause().printStackTrace();
  }
});
```

### Commit

To commit a transaction, call `commit` on the `JdbcConnection` object.

```java
connection.commit(commit -> {
  System.out.println("Commit succeeded ? " + commit.succeeded());
});
```

### Rollback

To rollback a transaction, call `rollback` on the `JdbcConnection` object.

```java
connection.rollback(rollback -> {
  System.out.println("Rollback succeeded ? " + rollback.succeeded());
});
```

## Configuring the service

TODO (or see docs)
