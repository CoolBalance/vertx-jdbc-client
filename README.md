# JDBC for Vert.x

A Vert.x library for interacting with a database that supports JDBC/SQL.

## Operations

The following operations are supported by this JDBC library and are all available either via the `JdbcConnection` or `JdbcTransaction` objects.

To get a connection

```java
service.connection(ar -> {
  if (ar.succeeded()) {
    JdbcConnection conn = ar.result();
  } else {
    ar.printStackTrace();
  }
});
```

or start a transaction
service.transaction(ar -> {
  if (ar.succeeded()) {
    JdbcTransaction transaction = ar.result();
  } else {
    ar.printStackTrace();
  }
});

### Execute

Executes the given sql on the database, returning nothing.

```java
String sql = "CREATE TABLE people (ID int generated by default as identity (start with 1 increment by 1) not null, FNAME varchar(255), LNAME varchar(255), DOB date);"
connection.execute(sql, ar -> {
  if (ar.succeeded()) {
    System.out.println("Table created !");
  } else {
    ar.cause().printStackTrace();
  }
});
```

### Update

Updates the database `INSERT`, `UPDATE`, `DELETE`, passing the sql and parameters (optional). The result is a JsonObject
telling you how many rows were updated and the generated keys (if any) if it was an insert.

```java

connection.update("INSERT INTO people VALUES (null, 'john', 'doe', '2000-01-01');", null, insertResult -> {
  if (insertResult.succeeded()) {
    JsonObject result = insertResult.result();
    System.out.println("Updated: " + insert.getInteger("updated");
    System.out.println("Generated keys: " + insert.getJsonArray("keys"));
  } else {
    insertResult.cause().printStackTrace();
  }
});

Update Result:

```javascript
{
  "updated" : 1     // number of rows effected by the update
  "keys"    : [1]   // array of generated keys
}
```


### Query

Queries the database (`SELECT`), passing the sql and parameters (optional). The result is a List of JsonObject's
representing the ResultSet of the query.

```java
JsonArray params = new JsonArray().add("doe");
connection.query("SELECT * FROM people WHERE lname = ?", params, queryResult -> {
  if (queryResult.succeeded()) {
    System.out.println(queryResult.result());
  } else {
    queryResult.cause().printStackTrace();
  }
});
```

## Transactions

Transactions are supported using the `JdbcTransaction` object which can be retrieved from the service.

To start/get a `JdbcTransaction` in order to execute jdbc actions within a transaction

```java
service.transaction(txResult -> {
  if (txResult.succeeded()) {
    JdbcTransaction transaction = txResult.result();
    // Now you can do a bunch of things for this transaction
    transaction.update(...);
    // etc
  } else {
    txResult.cause().printStackTrace();
  }
});
```

### Commit

To commit a transaction, call `commit` on the `JdbcTransaction` object.

```java
transaction.commit(commitResult -> {
  System.out.println("Commit succeeded ? " + commitResult.succeeded());
});
```

### Rollback

To rollback a transaction, call `rollback` using the transaction id.

```java
transaction.rollback(rollbackResult -> {
  System.out.println("Rollback succeeded ? " + rollbackResult.succeeded());
});
```